<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File List</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <h1>File List</h1>
    <ul>
        {% for file in files %}
            <li id="file-{{ file.id }}">
                {{ file.name }} - {{ file.status }} - {{ file.date }} - {{ file.size }} - {{ file.path }}
                {% if file.status == 0 %}
                    <button onclick="createCodeQL('{{ file.id }}', '{{ file.name }}')">Create CodeQL</button>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <script>
        function createCodeQL(fileId, fileName) {
            $.ajax({
                url: '/codeql-create',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ filename: fileName }),
                success: function(response) {
                    alert(response.message);
                    $('#file-' + fileId).find('button').prop('disabled', true);
                },
                error: function(error) {
                    alert(error.responseJSON.message);
                }
            });
        }
    </script>
</body>
</html>